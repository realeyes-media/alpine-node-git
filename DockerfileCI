FROM quay.io/realeyes/alpine-node-git:master

ENV CHGLOG_VERSION 0.7.1
ENV HUGO_VERSION 0.54.0

# Add that CI candy!
RUN apk add --update \
    curl wget zip && \
    rm -rf /tmp/* /var/cache/apk/*

# Install https://github.com/git-chglog
WORKDIR /temp
RUN wget https://github.com/git-chglog/git-chglog/releases/download/${CHGLOG_VERSION}/git-chglog_linux_amd64 && \
    mv git-chglog_linux_amd64 /usr/local/bin/git-chglog && \
    chmod +x /usr/local/bin/git-chglog

# Install Hugo SSG
RUN wget https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_Linux-64bit.tar.gz && \
    tar -xvzf hugo_extended_${HUGO_VERSION}_Linux-64bit.tar.gz && \
    mv hugo /usr/local/bin/hugo && \
    chmod +x /usr/local/bin/hugo

# Install AWS CLI
RUN apk -v --update add \
        python \
        py-pip \
        groff \
        less \
        mailcap \
        curl \
        git \
        && \
    pip install --upgrade awscli s3cmd python-magic && \
    apk -v --purge del py-pip && \
    rm /var/cache/apk/*

WORKDIR /build

RUN rm -rf temp

CMD ['/bin/bash']
